<div class="row" id="user-info-bar">
	<div class="ie-bg"></div>
	<div class="width-wrap">
		<div class="user-avatar-block">
			<div id="user-info-bar-user-avatar"></div>
        </div>
        <div class="user-info-block font-song-ti">
            <div class="line line-1"
                ><div class="cell user-name-block"
                    ><h3 class="font-default" 
                        ><span class="greeting">您好，</span
                        ><span class="user-name">用户</span
                    ></h3
                ></div
                ><div class="cell tips-block"
                    ><p
                        ><span class="tip-general">总有理财新发现</span>
                        <a class="tip-for-avatar" href="#">点击修改头像</a
                    ></p
                ></div
            ></div>
            <div class="line line-2"
            ></div>
        </div>
    </div>
    <script type="text/javascript">
        (function () {
            var avatar = new Avatar($('#user-info-bar-user-avatar')[0], {
                imageUri: '../images/_temp/fake-avatar-5.jpg',
                disableOldIEMask: false
            });


            var testTimeGapSeconds = 1;
                // avatar.update('../images/_temp/fake-avatar-3.png');

            setTimeout(function () {
                avatar.update('../images/_temp/fake-avatar-1.png', {
                    disableOldIEMask: false
                });
            }, testTimeGapSeconds*1000);

            setTimeout(function () {
                avatar.update('../images/_temp/fake-avatar-2.jpg');
            }, testTimeGapSeconds*2000);

            setTimeout(function () {
                avatar.update('../images/_temp/fake-avatar-5.jpg');
            }, testTimeGapSeconds*3000);





            function Avatar(avatarContainerElement, initOptions) {
                if (!avatarContainerElement) return undefined;

                var avatarElementClassName = 'avatar';
                var avatarBordersElementClassName = 'avatar-borders';
                var avatarIframeSrc = 'user-avatar.html';

                initOptions = initOptions || {};

                var isOldIE = typeof avatarContainerElement.filters === 'object'
                    && navigator.userAgent.search(' MSIE 8.0') > 0
                ;

                var disableOldIEMaskDefault = !!initOptions.disableOldIEMask && isOldIE;

                var avatarELement, avatarBordersElement;

                this.update = function (imageUri, options) { update.call(this, imageUri, options); }




                init.call(this);

                if (typeof initOptions.imageUri === 'string' && initOptions.imageUri) {
                    this.update(initOptions.imageUri);
                }




                function init() {
                    avatarELement = $(avatarContainerElement).find('.'+avatarElementClassName)[0];
                    avatarBordersElement = $(avatarContainerElement).find('.'+avatarBordersElementClassName)[0];

                    if (!isOldIE) {
                        if (!avatarELement) {
                            // console.log('Creating avatarELement...');
                            avatarELement = document.createElement('DIV');
                            avatarELement.className = avatarElementClassName;
                            avatarContainerElement.appendChild(avatarELement);
                        }

                        if (!avatarBordersElement) {
                            // console.log('Creating avatarBordersElement...');
                            avatarBordersElement = document.createElement('DIV');
                            avatarBordersElement.className = avatarBordersElementClassName;
                            avatarContainerElement.appendChild(avatarBordersElement);
                        }

                        return;
                    }

                    if (avatarELement) avatarELement.style.display = 'none';
                    if (avatarBordersElement) avatarBordersElement.style.display = 'none';
                }

                function update(imageUri, options) {
                    if (!isOldIE) {
                        avatarELement.style.backgroundImage = 'url('+imageUri+')';
                        return;
                    }

                    options = options || {};

                    var disableOldIEMask = disableOldIEMaskDefault;
                    if (typeof options.disableOldIEMask !== 'undefined') {
                        disableOldIEMask = !!options.disableOldIEMask && isOldIE;
                    }

                    var avatarIframeForOldIE = $(avatarContainerElement).find('iframe')[0];
                    if (avatarIframeForOldIE) {
                        // console.log('removing old iframe...');
                        avatarIframeForOldIE.src = '';
                        avatarIframeForOldIE.parentNode.removeChild(avatarIframeForOldIE);
                        avatarIframeForOldIE = null;
                    }

                    // console.log('Creating new iframe...');
                    avatarIframeForOldIE = document.createElement('IFRAME');
                    avatarIframeForOldIE.setAttribute('frameborder', '0');
                    avatarIframeForOldIE.setAttribute('scrolling', 'no');

                    // console.log('setting avatar to: "'+imageUri+'"\n\t      disableOldIEMask: ', disableOldIEMask, '\n');
                    var newSrc = avatarIframeSrc
                        +'?'+'avatarImage='+encodeURIComponent(imageUri)
                        +'&'+'disableOldIEMask='+disableOldIEMask
                    ;

                    // console.log('new src: "'+newSrc+'"');
                    avatarIframeForOldIE.src = newSrc;

                    avatarContainerElement.appendChild(avatarIframeForOldIE);
                }
            }
        })();
    </script>
</div>